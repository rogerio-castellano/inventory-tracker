@url=http://localhost:8080
# Run the login request at the bottom of this file (@name login) to obtain the auth token
@token={{login.response.body.$.access_token}}
@refreshToken={{login.response.body.$.refresh_token}}

###
POST {{url}}/register HTTP/1.1
Content-Type: application/json

{
    "username" : "rogerio",
    "password": "very-secret"
}

###
POST {{url}}/admin/users HTTP/1.1
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "username" : "adrian",
    "password": "top-secret",
    "role": "admin"
}

###
GET {{url}}/me HTTP/1.1
Authorization: Bearer {{token}}

###
# @name refresh
POST {{url}}/refresh HTTP/1.1
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "username" : "admin",
    "refresh_token": "{{refreshToken}}"
}

### Test refresh token
# 1) Run @name login
# 2) Run @name refresh
# 3) Run this request
GET {{url}}/me HTTP/1.1
Authorization: Bearer {{refresh.response.body.$.access_token}}

###
GET {{url}}/admin/tokens HTTP/1.1
Authorization: Bearer {{token}}

### Test tokens removal next 2 requests (POST and DELETE)
POST {{url}}/login HTTP/1.1
Content-Type: application/json
User-Agent: rest-client1

{
    "username": "adrian",
    "password": "top-secret"
}
###
DELETE {{url}}/admin/tokens/adrian HTTP/1.1
Authorization: Bearer {{token}}

###
POST {{url}}/logout HTTP/1.1
Authorization: Bearer {{token}}

###
POST {{url}}/logout/all HTTP/1.1
Authorization: Bearer {{token}}
###
GET {{url}}/admin/users/adrian/tokens HTTP/1.1
Authorization: Bearer {{token}}
Content-Type: application/json

###
DELETE {{url}}/admin/users/adrian/tokens HTTP/1.1
Authorization: Bearer {{token}}
Content-Type: application/json




###
# Login with valid credentials (keep it after business endpoints)
# @name login
POST {{url}}/login HTTP/1.1
Content-Type: application/json

{
    "username": "admin",
    "password": "secret"
}
